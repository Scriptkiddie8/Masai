<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Signup</title>
    <style>
      body {
        /* background-color: #000; */
        margin: 0;
        padding: 0;
      }

      .cart-wrapper {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        backdrop-filter: blur(5px);
        /* background-color: rgba(255, 255, 255, 0.2); */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .form-container {
        width: 350px;
        background-color: #fff;
        box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        border-radius: 10px;
        box-sizing: border-box;
        padding: 20px 30px;
      }

      .title {
        text-align: center;
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 30px;
      }

      .form {
        display: flex;
        flex-direction: column;
        gap: 18px;
        margin-bottom: 15px;
      }

      .input {
        border-radius: 20px;
        border: 1px solid #c0c0c0;
        padding: 12px 15px;
        outline: none;
      }

      .form-btn {
        padding: 10px 15px;
        border-radius: 20px;
        border: none;
        background: teal;
        color: white;
        cursor: pointer;
      }

      .form-btn:active {
        box-shadow: none;
      }

      .sign-up-label {
        font-size: 12px;
        color: #747474;
        text-align: center;
      }

      .sign-up-link {
        margin-left: 5px;
        text-decoration: underline;
        color: teal;
        cursor: pointer;
        font-weight: 700;
      }

      .close-btn {
        float: right;
        font-size: 1.2rem;
        cursor: pointer;
      }

      .close-btn:hover {
        color: red;
      }

      #user-email {
        color: green;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="cart-wrapper" id="cartwrapper">
      <div class="form-container" id="formcontainer">
        <!-- Login form will be shown first -->
        <p class="title">
          Welcome back <span class="close-btn" onclick="closeCart()">✖</span>
        </p>
        <form class="form">
          <input
            type="email"
            class="input"
            id="login-email"
            placeholder="Email"
          />
          <input
            type="password"
            class="input"
            id="login-password"
            placeholder="Password"
          />
          <button type="button" class="form-btn" id="login-btn">Log in</button>
        </form>
        <p class="sign-up-label">
          Don't have an account?
          <span class="sign-up-link" onclick="showSignup()">Sign up</span>
        </p>
        <p id="user-email"></p>
      </div>
    </div>

    <!-- Firebase Authentication Script -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAj8RLoUppNcmStrE40UYd7HTfGtr0gg6c",
        authDomain: "traveling-agency-de6ca.firebaseapp.com",
        databaseURL:
          "https://traveling-agency-de6ca-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "traveling-agency-de6ca",
        storageBucket: "traveling-agency-de6ca.appspot.com",
        messagingSenderId: "613059044293",
        appId: "1:613059044293:web:beb92d45e37a0a04c421ac",
        measurementId: "G-20E2QCL82Y",
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);

      // Show Signup Form
      window.showSignup = function () {
        const formContainer = document.getElementById("formcontainer");
        formContainer.innerHTML = `
          <p class="title">Create Account <span class="close-btn" onclick="closeCart()">✖</span></p>
          <form class="form">
            <input type="email" class="input" id="signup-email" placeholder="Email" required />
            <input type="password" class="input" id="signup-password" placeholder="Password" required />
            <button type="button" class="form-btn" id="signup-btn">Sign up</button>
          </form>
          <p class="sign-up-label">
            Already have an account?
            <span class="sign-up-link" onclick="showLogin()">Log in</span>
          </p>
          <p id="user-email"></p>
        `;

        // ✅ Add Event Listener AFTER DOM insertion
        document.getElementById("signup-btn").addEventListener("click", () => {
          const email = document.getElementById("signup-email").value;
          const password = document.getElementById("signup-password").value;

          createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
              // alert("Signup successful!");
            })
            .catch((error) => {
              alert("Signup failed: " + error.message);
              console.error(error.message);
            });
        });

        onAuthStateChanged(auth, (user) => {
          if (user) {
            // Inform parent window about login

            document.getElementById(
              "user-email"
            ).innerText = `Welcome, ${user.email}`;
            setTimeout(() => {
              document.getElementById("cartwrapper").style.display = "none";
              window.parent.postMessage(
                { status: "loggedIn", email: user.email },
                "*"
              );
            }, 2000);
          }
        });
      };

      // Show Login Form
      window.showLogin = function () {
        const formContainer = document.getElementById("formcontainer");
        formContainer.innerHTML = `
          <p class="title">Welcome back <span class="close-btn" onclick="closeCart()">✖</span></p>
          <form class="form">
            <input type="email" class="input" id="login-email" placeholder="Email" />
            <input type="password" class="input" id="login-password" placeholder="Password" />
            <button type="button" class="form-btn" id="login-btn">Log in</button>
          </form>
          <p class="sign-up-label">
            Don't have an account?
            <span class="sign-up-link" onclick="showSignup()">Sign up</span>
          </p>
           <p id="user-email"></p>
        `;

        // You can also attach login logic here if needed
      };

      document.getElementById("login-btn").addEventListener("click", () => {
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            document.getElementById(
              "user-email"
            ).innerText = `Welcome Back, ${userCredential.user.email}`;
            setTimeout(() => {
              document.getElementById("cartwrapper").style.display = "none";
              window.parent.postMessage(
                { status: "loggedIn", email: userCredential.user.email },
                "*"
              );
            }, 2000);
          })
          .catch((error) => {
            alert(error.message);
          });
      });

      // Close popup
      window.closeCart = function () {
        document.getElementById("cartwrapper").style.display = "none";
      };

      // Show popup manually (for testing)
      document.getElementById("cartwrapper").style.display = "flex";
    </script>
  </body>
</html>
